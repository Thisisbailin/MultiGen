# 角色 & 场景资料库（macOS）

## 目标
- 为 AIGC 创作流程提供角色与场景的集中管理入口，支持从文本描述到多形态/多素材的视觉资产管理。
- 与项目绑定：每个项目维护自己的角色与场景集合；跨项目不共享。
- 覆盖生成提示词 → 外部生图 → 上传素材 → 设封面 → 多子版本的闭环。

## 信息架构
- 一级页面（列表视图）：按项目筛选，支持卡片/列表模式切换，列表模式可拖拽排序。
- 二级页面（详情视图）：顶部原生 toolbar（返回/上一项/下一项/编辑/保存），标题栏展示当前角色/场景名称，区分“查看/编辑”两种态。
- 数据模型（绑定项目）：
  - `ProjectCharacterProfile`：`name/description/prompt/variants[]/primaryImageData`
  - `ProjectSceneProfile`：`name/description/prompt/variants[]/primaryImageData`
  - `Variant`（角色/场景复用）：`label/promptOverride/images[]`，`images` 含 `isCover`，用于封面。

## 功能要点
- 卡片展示：封面全幅覆盖，底部渐变叠加标题与形态/素材计数；点击进入详情。卡片/列表视图可自由切换。
- 提示词助手：角色/场景模块右侧默认载入“提示词助手”（Prompt Library 子模块），复用项目剧本文本上下文，为当前选中角色/场景生成中文文生图提示词并写回主 `prompt` 字段（覆盖策略）。
- 提示词生成：基于名称/描述调用 AI 文本通道生成文生图提示词，写回 `prompt` 或子版本 `promptOverride`。
- 多子版本：可添加/重命名子版本（形态/视角），每个子版本有独立的提示词与素材集，支持设封面。
- 素材上传与管理：支持多图上传，设封面、删除；未上传时显示占位。封面用于卡片/列表封面。
- 排序：列表模式可拖拽调整角色/场景顺序，持久化到项目。

## 交互细节
- 详情页：
  - 基础信息：查看态显示名称/描述；编辑态可直接修改。
  - 提示词：查看态显示纯文本；编辑态 TextEditor + “AI 生成”按钮。
  - 子版本与素材：查看态横向预览；编辑态使用 `VariantEditor` 上传/设封面/删除，并编辑子版本提示词。
  - Toolbar：返回、上一项/下一项（循环导航）、编辑/保存切换。
- 一级列表/卡片：
  - 项目筛选 Picker（toolbar 菜单）。
  - 视图切换 Segmented（toolbar）。
  - 新增按钮（toolbar）。
  - 卡片网格：3 列、加大间距，便于预览。
  - 列表：plain 样式，行显示名称与“有/无提示词”，支持拖拽排序。

## 数据写入与兼容
- 初始化/更新时规范化 assets：旧版单封面迁移为默认子版本；确保每个子版本有唯一封面标记。
- 保存时直接写入项目下的角色/场景集合（覆盖模式），排序随列表拖拽持久化。

## 后续迭代方向
- 提示词版本化/比对，AI 优化建议。
- 子版本差异高亮（封面/提示词变更对比）。
- 更丰富的卡片展开态、快捷复制提示词、拖拽上传。
- 跨项目引用/克隆（未来可选）。 
